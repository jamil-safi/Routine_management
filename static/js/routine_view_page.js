



// const RoutineData = {
//   sectionA: {
//     SUN: {
//       1: {
//         courseId: "ct",
//         section: "CT",
//         periodSpan: 1,
//         room_id: "room1",
//         room_name: "Room 1",
//         is_sessional: false,
//       },
//       2: {
//         courseId: "cse313",
//         section: "CSE-313",
//         periodSpan: 1,
//         room_id: "room2",
//         room_name: "Room 2",
//         is_sessional: false,
//       },
//       4: {
//         courseId: "cse336",
//         section: "CSE-336 - Computer Lab 1",
//         periodSpan: 3,
//         room_id: "lab101",
//         room_name: "Computer Lab 1",
//         is_sessional: true,
//       },
//     },
//     MON: {
//       1: {
//         courseId: "ct",
//         section: "CT",
//         periodSpan: 1,
//         room_id: "room3",
//         room_name: "Room 3",
//         is_sessional: false,
//       },
//       3: {
//         courseId: "cse335",
//         section: "CSE-335",
//         periodSpan: 1,
//         room_id: "room4",
//         room_name: "Room 4",
//         is_sessional: false,
//       },
//       5: {
//         courseId: "cse331",
//         section: "CSE-331",
//         periodSpan: 1,
//         room_id: "room5",
//         room_name: "Room 5",
//         is_sessional: false,
//       },
//     },
//     TUE: {
//       2: {
//         courseId: "cse313",
//         section: "CSE-313",
//         periodSpan: 1,
//         room_id: "room6",
//         room_name: "Room 6",
//         is_sessional: false,
//       },
//       4: {
//         courseId: "cse331",
//         section: "CSE-331",
//         periodSpan: 1,
//         room_id: "room7",
//         room_name: "Room 7",
//         is_sessional: false,
//       },
//       7: {
//         courseId: "cse354",
//         section: "CSE-354 - Electronics Lab",
//         periodSpan: 2,
//         room_id: "lab301",
//         room_name: "Electronics Lab",
//         is_sessional: true,
//       },
//     },
//     WED: {
//       1: {
//         courseId: "ct",
//         section: "CT",
//         periodSpan: 1,
//         room_id: "room8",
//         room_name: "Room 8",
//         is_sessional: false,
//       },
//       3: {
//         courseId: "cse335",
//         section: "CSE-335",
//         periodSpan: 1,
//         room_id: "room9",
//         room_name: "Room 9",
//         is_sessional: false,
//       },
//       5: {
//         courseId: "cse313",
//         section: "CSE-313",
//         periodSpan: 1,
//         room_id: "room10",
//         room_name: "Room 10",
//         is_sessional: false,
//       },
//     },
//     THU: {
//       2: {
//         courseId: "cse331",
//         section: "CSE-331",
//         periodSpan: 1,
//         room_id: "room1",
//         room_name: "Room 1",
//         is_sessional: false,
//       },
//       4: {
//         courseId: "cse335",
//         section: "CSE-335",
//         periodSpan: 1,
//         room_id: "room2",
//         room_name: "Room 2",
//         is_sessional: false,
//       },
//     },
//   },
//   sectionB: {
//     SUN: {
//       1: {
//         courseId: "ct",
//         section: "CT",
//         periodSpan: 1,
//         room_id: "room3",
//         room_name: "Room 3",
//         is_sessional: false,
//       },
//       3: {
//         courseId: "cse313",
//         section: "CSE-313",
//         periodSpan: 1,
//         room_id: "room4",
//         room_name: "Room 4",
//         is_sessional: false,
//       },
//       5: {
//         courseId: "cse336",
//         section: "CSE-336 - Computer Lab 2",
//         periodSpan: 2,
//         room_id: "lab102",
//         room_name: "Computer Lab 2",
//         is_sessional: true,
//       },
//     },
//     MON: {
//       2: {
//         courseId: "cse335",
//         section: "CSE-335",
//         periodSpan: 1,
//         room_id: "room5",
//         room_name: "Room 5",
//         is_sessional: false,
//       },
//       4: {
//         courseId: "cse331",
//         section: "CSE-331",
//         periodSpan: 1,
//         room_id: "room6",
//         room_name: "Room 6",
//         is_sessional: false,
//       },
//       6: {
//         courseId: "ct",
//         section: "CT",
//         periodSpan: 1,
//         room_id: "room7",
//         room_name: "Room 7",
//         is_sessional: false,
//       },
//     },
//     TUE: {
//       1: {
//         courseId: "ct",
//         section: "CT",
//         periodSpan: 1,
//         room_id: "room8",
//         room_name: "Room 8",
//         is_sessional: false,
//       },
//       3: {
//         courseId: "cse313",
//         section: "CSE-313",
//         periodSpan: 1,
//         room_id: "room9",
//         room_name: "Room 9",
//         is_sessional: false,
//       },
//       7: {
//         courseId: "cse354",
//         section: "CSE-354 - Network Lab",
//         periodSpan: 2,
//         room_id: "lab302",
//         room_name: "Network Lab",
//         is_sessional: true,
//       },
//     },
//     WED: {
//       2: {
//         courseId: "cse335",
//         section: "CSE-335",
//         periodSpan: 1,
//         room_id: "room10",
//         room_name: "Room 10",
//         is_sessional: false,
//       },
//       4: {
//         courseId: "cse331",
//         section: "CSE-331",
//         periodSpan: 1,
//         room_id: "room1",
//         room_name: "Room 1",
//         is_sessional: false,
//       },
//       6: {
//         courseId: "cse313",
//         section: "CSE-313",
//         periodSpan: 1,
//         room_id: "room2",
//         room_name: "Room 2",
//         is_sessional: false,
//       },
//     },
//     THU: {
//       1: {
//         courseId: "ct",
//         section: "CT",
//         periodSpan: 1,
//         room_id: "room3",
//         room_name: "Room 3",
//         is_sessional: false,
//       },
//       3: {
//         courseId: "cse335",
//         section: "CSE-335",
//         periodSpan: 1,
//         room_id: "room4",
//         room_name: "Room 4",
//         is_sessional: false,
//       },
//       5: {
//         courseId: "cse331",
//         section: "CSE-331",
//         periodSpan: 1,
//         room_id: "room5",
//         room_name: "Room 5",
//         is_sessional: false,
//       },
//     },
//   },
// };

const timeSlots = [
  { period: 1, startTime: "8:10", endTime: "9:00" },
  { period: 2, startTime: "9:00", endTime: "9:50" },
  { period: 3, startTime: "9:50", endTime: "10:40" },
  { period: 4, startTime: "11:00", endTime: "11:50" },
  { period: 5, startTime: "11:50", endTime: "12:40" },
  { period: 6, startTime: "12:40", endTime: "1:30" },
  { period: 7, startTime: "2:30", endTime: "3:20" },
  { period: 8, startTime: "3:20", endTime: "4:10" },
  { period: 9, startTime: "4:10", endTime: "5:00" },
]

const days = ["SUN", "MON", "TUE", "WED", "THU"]
currentEditingRoutineId = null
let RoutineData = {
  sectionA:{},
  sectionB:{}
}

function getCourseById(courseId) {
  if (courseId === "ct") return { code: "CT", name: "Class Test" }

  const courses = {
    cse313: { code: "CSE-313", name: "Database Systems" },
    cse331: { code: "CSE-331", name: "Software Engineering" },
    cse335: { code: "CSE-335", name: "Computer Networks" },
    cse336: { code: "CSE-336", name: "Database Lab" },
    cse354: { code: "CSE-354", name: "Software Lab" },
  }

  return courses[courseId] || { code: courseId, name: courseId }
}


document.addEventListener("DOMContentLoaded", () => {
  const page = document.body.dataset.page;
  if (page === "view_routine") {
    fetch('/api/edit_routine')
      .then(response => {
        if (!response.ok) throw new Error('Network error');
        return response.json();
      })
      .then(data => { 
        currentEditingRoutineId = Number(data.routine_id);
        RoutineData = data.routine_data
        // Transform teachers (optional styling)
        console.log(currentEditingRoutineId);
        renderRoutineView();
      })

      .catch(err => {
        console.error("Error:", err);
        //showToast("Failed to load routine data");
    });
  }
});

// Routine View Functions
function renderRoutineView() {
  const container = document.getElementById("routine-view-table")
  if (!container) return

  container.innerHTML = createMergedSectionTable()
}

function createMergedSectionTable() {
  const html = `
  <div class="merged-routine-container">
    <!-- Section A Table -->
    <div class="section-routine-table">
      <div class="section-header">
        <div class="flex items-center gap-4">
          <svg class="h-5 w-5 text-indigo-600" viewBox="0 0 24 24" fill="none" stroke="currentColor">
            <rect x="3" y="4" width="18" height="18" rx="2" ry="2"/>
            <line x1="16" y1="2" x2="16" y2="6"/>
            <line x1="8" y1="2" x2="8" y2="6"/>
            <line x1="3" y1="10" x2="21" y2="10"/>
          </svg>
          <h2>Section A Routine</h2>
        </div>
        <span class="section-badge section-a">Section A</span>
      </div>
      ${createSectionViewTable(RoutineData.sectionA, "A")}
    </div>

    <!-- Section B Table -->
    <div class="section-routine-table">
      <div class="section-header">
        <div class="flex items-center gap-4">
          <svg class="h-5 w-5 text-indigo-600" viewBox="0 0 24 24" fill="none" stroke="currentColor">
            <rect x="3" y="4" width="18" height="18" rx="2" ry="2"/>
            <line x1="16" y1="2" x2="16" y2="6"/>
            <line x1="8" y1="2" x2="8" y2="6"/>
            <line x1="3" y1="10" x2="21" y2="10"/>
          </svg>
          <h2>Section B Routine</h2>
        </div>
        <span class="section-badge section-b">Section B</span>
      </div>
      ${createSectionViewTable(RoutineData.sectionB, "B")}
    </div>
  </div>
`
  return html
}



function createSectionViewTable(routineData, sectionName) {
  let html = `
  <div class="routine-table-container">
    <table class="routine-table">
      <thead>
        <tr>
          <th>Day</th>
`

  timeSlots.forEach((slot) => {
    html += `<th>${slot.startTime}<br/>to<br/>${slot.endTime}</th>`
  })

  html += `
        </tr>
      </thead>
      <tbody>
`

  days.forEach((day) => {
    html += `<tr><td class="day-cell">${day}</td>`

    timeSlots.forEach((slot) => {
      const cell = routineData[day]?.[slot.period]

      // Skip occupied cells
      if (cell && cell.section === "occupied") {
        return
      }

      const colSpan = cell?.periodSpan || 1

      html += `<td colspan="${colSpan}">${createCourseCell(cell)}</td>`
    })

    html += `</tr>`
  })

  html += `
      </tbody>
    </table>
  </div>
`

  return html
}

function createCourseCell(cell) {
  if (!cell || !cell.courseId) {
    return '<span style="color: #9ca3af;">-</span>'
  }

  const course = getCourseById(cell.courseId)
  const isClassTest = cell.courseId === "ct"
  const isLab = cell.is_sessional

  let colorClass = "blue"
  if (isClassTest) {
    colorClass = "purple"
  } else if (isLab) {
    colorClass = "amber"
  }

  let html = `
  <div class="course-cell ${colorClass}">
    <div class="course-name">${cell.section}</div>
`

  if (!isClassTest) {
    html += `<div class="course-details">${course.name}</div>`
  }

  if (cell.periodSpan && cell.periodSpan > 1) {
    html += `<div class="period-badge">${cell.periodSpan} periods</div>`
  }

  html += `</div>`

  return html
}
